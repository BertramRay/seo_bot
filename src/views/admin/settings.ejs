<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SEO博客 - 系统设置</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Helvetica Neue', Arial, sans-serif;
      background-color: #f5f5f5;
    }
    .sidebar {
      background-color: #343a40;
      min-height: 100vh;
      color: white;
    }
    .sidebar a {
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      padding: 10px 15px;
      display: block;
    }
    .sidebar a:hover {
      color: white;
      background-color: rgba(255, 255, 255, 0.1);
    }
    .sidebar .active {
      background-color: rgba(255, 255, 255, 0.2);
      color: white;
    }
    .content {
      padding: 20px;
    }
    .nav-tabs {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="container-fluid">
    <div class="row">
      <!-- 侧边栏 -->
      <div class="col-md-2 sidebar p-0">
        <div class="py-4 px-3 mb-4">
          <h5>SEO博客管理</h5>
        </div>
        <ul class="nav flex-column">
          <li class="nav-item">
            <a href="/admin">仪表盘</a>
          </li>
          <li class="nav-item">
            <a href="/admin/topics">主题管理</a>
          </li>
          <li class="nav-item">
            <a href="/admin/posts">文章管理</a>
          </li>
          <li class="nav-item">
            <a href="/admin/generate">生成内容</a>
          </li>
          <li class="nav-item">
            <a href="/admin/settings" class="active">系统设置</a>
          </li>
        </ul>
      </div>
      
      <!-- 主内容区 -->
      <div class="col-md-10 content">
        <h2 class="mb-4">系统设置</h2>
        
        <!-- 设置选项卡 -->
        <ul class="nav nav-tabs" id="settingsTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab" aria-controls="general" aria-selected="true">基本设置</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="content-tab" data-bs-toggle="tab" data-bs-target="#content" type="button" role="tab" aria-controls="content" aria-selected="false">内容设置</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="seo-tab" data-bs-toggle="tab" data-bs-target="#seo" type="button" role="tab" aria-controls="seo" aria-selected="false">SEO设置</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="schedule-tab" data-bs-toggle="tab" data-bs-target="#schedule" type="button" role="tab" aria-controls="schedule" aria-selected="false">定时任务</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="api-tab" data-bs-toggle="tab" data-bs-target="#api" type="button" role="tab" aria-controls="api" aria-selected="false">API设置</button>
          </li>
        </ul>
        
        <div class="tab-content" id="settingsTabContent">
          <!-- 基本设置 -->
          <div class="tab-pane fade show active" id="general" role="tabpanel" aria-labelledby="general-tab">
            <div class="card">
              <div class="card-body">
                <form action="/admin/settings/update" method="POST" id="generalForm">
                  <input type="hidden" name="section" value="general">
                  
                  <div class="mb-3">
                    <label for="blogTitle" class="form-label">博客标题</label>
                    <input type="text" class="form-control" id="blogTitle" name="blog[title]" value="<%= config.blog.title %>" required>
                  </div>
                  
                  <div class="mb-3">
                    <label for="blogDescription" class="form-label">博客描述</label>
                    <textarea class="form-control" id="blogDescription" name="blog[description]" rows="2"><%= config.blog.description %></textarea>
                  </div>
                  
                  <div class="mb-3">
                    <label for="siteUrl" class="form-label">网站地址</label>
                    <input type="url" class="form-control" id="siteUrl" name="blog[siteUrl]" value="<%= config.blog.siteUrl %>">
                    <div class="form-text">完整的网站URL，如 https://yourdomain.com</div>
                  </div>
                  
                  <div class="mb-3">
                    <label for="blogPath" class="form-label">博客路径</label>
                    <input type="text" class="form-control" id="blogPath" name="blog[blogPath]" value="<%= config.blog.blogPath %>">
                    <div class="form-text">博客的访问路径，如 /blog</div>
                  </div>
                  
                  <div class="mb-3">
                    <label for="serverPort" class="form-label">服务器端口</label>
                    <input type="number" class="form-control" id="serverPort" name="server[port]" value="<%= config.server.port %>">
                    <div class="form-text">更改后需要重启服务器</div>
                  </div>
                  
                  <div class="mb-3">
                    <label for="logLevel" class="form-label">日志级别</label>
                    <select class="form-select" id="logLevel" name="logging[level]">
                      <option value="debug" <%= config.logging.level === 'debug' ? 'selected' : '' %>>调试</option>
                      <option value="info" <%= config.logging.level === 'info' ? 'selected' : '' %>>信息</option>
                      <option value="warn" <%= config.logging.level === 'warn' ? 'selected' : '' %>>警告</option>
                      <option value="error" <%= config.logging.level === 'error' ? 'selected' : '' %>>错误</option>
                    </select>
                  </div>
                  
                  <button type="submit" class="btn btn-primary">保存基本设置</button>
                </form>
              </div>
            </div>
          </div>
          
          <!-- 内容设置 -->
          <div class="tab-pane fade" id="content" role="tabpanel" aria-labelledby="content-tab">
            <div class="card">
              <div class="card-body">
                <form action="/admin/settings/update" method="POST" id="contentForm">
                  <input type="hidden" name="section" value="content">
                  
                  <div class="mb-3">
                    <label for="postsPerBatch" class="form-label">每批文章数量</label>
                    <input type="number" class="form-control" id="postsPerBatch" name="content[postsPerBatch]" value="<%= config.content.postsPerBatch %>" min="1" max="50">
                    <div class="form-text">定时生成时每次生成的文章数量</div>
                  </div>
                  
                  <div class="row">
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label for="minWordsPerPost" class="form-label">最小字数</label>
                        <input type="number" class="form-control" id="minWordsPerPost" name="content[minWordsPerPost]" value="<%= config.content.minWordsPerPost %>" min="300" max="10000">
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label for="maxWordsPerPost" class="form-label">最大字数</label>
                        <input type="number" class="form-control" id="maxWordsPerPost" name="content[maxWordsPerPost]" value="<%= config.content.maxWordsPerPost %>" min="500" max="10000">
                      </div>
                    </div>
                  </div>
                  
                  <div class="mb-3">
                    <label class="form-label">自动发布</label>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="autoPublish" name="content[autoPublish]" <%= config.content.autoPublish ? 'checked' : '' %>>
                      <label class="form-check-label" for="autoPublish">
                        自动发布生成的文章
                      </label>
                    </div>
                  </div>
                  
                  <button type="submit" class="btn btn-primary">保存内容设置</button>
                </form>
              </div>
            </div>
          </div>
          
          <!-- SEO设置 -->
          <div class="tab-pane fade" id="seo" role="tabpanel" aria-labelledby="seo-tab">
            <div class="card">
              <div class="card-body">
                <form action="/admin/settings/update" method="POST" id="seoForm">
                  <input type="hidden" name="section" value="seo">
                  
                  <div class="mb-3">
                    <label for="defaultKeywords" class="form-label">默认关键词</label>
                    <input type="text" class="form-control" id="defaultKeywords" name="seo[defaultKeywords]" value="<%= config.seo.defaultKeywords.join(',') %>">
                    <div class="form-text">多个关键词用逗号分隔</div>
                  </div>
                  
                  <div class="mb-3">
                    <label for="language" class="form-label">内容语言</label>
                    <select class="form-select" id="language" name="seo[language]">
                      <option value="zh-CN" <%= config.seo.language === 'zh-CN' ? 'selected' : '' %>>中文</option>
                      <option value="en" <%= config.seo.language === 'en' ? 'selected' : '' %>>英文</option>
                    </select>
                  </div>
                  
                  <div class="mb-3">
                    <label class="form-label">站点地图</label>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="generateSitemap" name="seo[generateSitemap]" <%= config.seo.generateSitemap ? 'checked' : '' %>>
                      <label class="form-check-label" for="generateSitemap">
                        自动生成站点地图
                      </label>
                    </div>
                  </div>
                  
                  <div class="mb-3">
                    <label for="sitemapFrequency" class="form-label">站点地图更新频率</label>
                    <select class="form-select" id="sitemapFrequency" name="seo[sitemapFrequency]">
                      <option value="hourly" <%= config.seo.sitemapFrequency === 'hourly' ? 'selected' : '' %>>每小时</option>
                      <option value="daily" <%= config.seo.sitemapFrequency === 'daily' ? 'selected' : '' %>>每天</option>
                      <option value="weekly" <%= config.seo.sitemapFrequency === 'weekly' ? 'selected' : '' %>>每周</option>
                    </select>
                  </div>
                  
                  <button type="submit" class="btn btn-primary">保存SEO设置</button>
                </form>
              </div>
            </div>
          </div>
          
          <!-- 定时任务 -->
          <div class="tab-pane fade" id="schedule" role="tabpanel" aria-labelledby="schedule-tab">
            <div class="card">
              <div class="card-body">
                <form action="/admin/settings/update" method="POST" id="scheduleForm">
                  <input type="hidden" name="section" value="schedule">
                  
                  <div class="mb-3">
                    <label for="contentFrequency" class="form-label">内容生成频率</label>
                    <select class="form-select" id="contentFrequency" name="content[frequency]">
                      <option value="hourly" <%= config.content.frequency === 'hourly' ? 'selected' : '' %>>每小时</option>
                      <option value="daily" <%= config.content.frequency === 'daily' ? 'selected' : '' %>>每天</option>
                      <option value="weekly" <%= config.content.frequency === 'weekly' ? 'selected' : '' %>>每周</option>
                      <option value="custom" <%= config.content.frequency === 'custom' ? 'selected' : '' %>>自定义</option>
                      <option value="disabled" <%= config.content.frequency === 'disabled' ? 'selected' : '' %>>禁用</option>
                    </select>
                  </div>
                  
                  <div class="mb-3" id="customCronContainer" <% if(config.content.frequency !== 'custom') { %>style="display:none;"<% } %>>
                    <label for="customCronExpression" class="form-label">自定义Cron表达式</label>
                    <input type="text" class="form-control" id="customCronExpression" name="content[customCronExpression]" value="<%= config.content.customCronExpression || '0 3 * * *' %>">
                    <div class="form-text">Cron表达式格式：分 时 日 月 周</div>
                  </div>
                  <button type="submit" class="btn btn-primary">保存定时设置</button>
                  
                  <hr>
                  
                  <h5>定时任务控制</h5>
                  <div class="mb-3">
                    <button type="button" class="btn btn-warning me-2" id="stopJobsBtn">停止所有任务</button>
                    <button type="button" class="btn btn-success" id="startJobsBtn">启动所有任务</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
          
          <!-- API设置 -->
          <div class="tab-pane fade" id="api" role="tabpanel" aria-labelledby="api-tab">
            <div class="card">
              <div class="card-body">
                <form action="/admin/settings/update" method="POST" id="apiForm">
                  <input type="hidden" name="section" value="api">
                  
                  <div class="mb-3">
                    <label for="openaiApiKey" class="form-label">OpenAI API密钥</label>
                    <input type="password" class="form-control" id="openaiApiKey" name="openai[apiKey]" value="<%= config.openai.apiKey %>">
                    <div class="form-text">用于生成内容的OpenAI API密钥</div>
                  </div>
                  
                  <div class="mb-3">
                    <label for="databaseUri" class="form-label">数据库连接URI</label>
                    <input type="text" class="form-control" id="databaseUri" name="database[uri]" value="<%= config.database.uri %>">
                    <div class="form-text">MongoDB连接字符串，更改后需重启服务器</div>
                  </div>
                  
                  <button type="submit" class="btn btn-primary">保存API设置</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // 显示/隐藏自定义Cron表达式输入框
    document.getElementById('contentFrequency').addEventListener('change', function() {
      const customCronContainer = document.getElementById('customCronContainer');
      if (this.value === 'custom') {
        customCronContainer.style.display = 'block';
      } else {
        customCronContainer.style.display = 'none';
      }
    });
    
    // 停止所有任务按钮
    document.getElementById('stopJobsBtn').addEventListener('click', function() {
      if (confirm('确定要停止所有定时任务吗？')) {
        fetch('/admin/scheduler/stop', {
          method: 'POST',
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert('已停止所有定时任务');
          } else {
            alert('停止任务失败: ' + data.message);
          }
        })
        .catch(error => {
          alert('操作失败: ' + error);
        });
      }
    });
    
    // 启动所有任务按钮
    document.getElementById('startJobsBtn').addEventListener('click', function() {
      if (confirm('确定要启动所有定时任务吗？')) {
        fetch('/admin/scheduler/start', {
          method: 'POST',
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert('已启动所有定时任务');
          } else {
            alert('启动任务失败: ' + data.message);
          }
        })
        .catch(error => {
          alert('操作失败: ' + error);
        });
      }
    });
  </script>
</body>
</html> 