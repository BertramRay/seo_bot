# 系统架构文档

本文档详细描述了 SEO 博客生成系统的架构设计和各个模块的职责。

## 架构概览

SEO 博客生成系统采用分层架构设计，主要分为以下几层：

1. **表示层**：处理HTTP请求和响应，包括Web界面和API接口
2. **业务逻辑层**：实现核心业务逻辑
3. **数据访问层**：处理数据的存储和检索
4. **基础设施层**：提供跨层次的通用功能

系统架构图如下：

```
┌─────────────────────────────────────────────────────────────┐
│                        表示层 (Presentation)                  │
│                                                             │
│  ┌─────────────────┐            ┌──────────────────────┐    │
│  │     Web界面      │            │      API接口         │    │
│  │  (Controllers)  │            │     (API Routes)     │    │
│  └─────────────────┘            └──────────────────────┘    │
└───────────────────────────┬─────────────────────────────────┘
                            │
┌───────────────────────────▼─────────────────────────────────┐
│                     业务逻辑层 (Business Logic)               │
│                                                             │
│  ┌─────────────────┐  ┌─────────────────┐  ┌──────────────┐ │
│  │   内容生成服务    │  │    主题服务      │  │   文章服务    │ │
│  │ (ContentGenerator)│ │ (TopicService)  │  │(PostService) │ │
│  └─────────────────┘  └─────────────────┘  └──────────────┘ │
│                                                             │
│  ┌─────────────────┐  ┌─────────────────┐  ┌──────────────┐ │
│  │    SEO服务      │  │    调度服务      │  │   用户服务    │ │
│  │  (SEOService)   │  │  (Scheduler)    │  │(UserService) │ │
│  └─────────────────┘  └─────────────────┘  └──────────────┘ │
└───────────────────────────┬─────────────────────────────────┘
                            │
┌───────────────────────────▼─────────────────────────────────┐
│                     数据访问层 (Data Access)                  │
│                                                             │
│  ┌─────────────────┐  ┌─────────────────┐  ┌──────────────┐ │
│  │   文章仓库       │  │    主题仓库      │  │   用户仓库    │ │
│  │ (PostRepository)│  │(TopicRepository)│  │(UserRepository)│
│  └─────────────────┘  └─────────────────┘  └──────────────┘ │
└───────────────────────────┬─────────────────────────────────┘
                            │
┌───────────────────────────▼─────────────────────────────────┐
│                     基础设施层 (Infrastructure)               │
│                                                             │
│  ┌─────────────────┐  ┌─────────────────┐  ┌──────────────┐ │
│  │    数据库        │  │    日志系统      │  │   配置管理    │ │
│  │   (MongoDB)     │  │    (Logger)     │  │  (Config)    │ │
│  └─────────────────┘  └─────────────────┘  └──────────────┘ │
│                                                             │
│  ┌─────────────────┐  ┌─────────────────┐  ┌──────────────┐ │
│  │   AI接口        │  │    认证系统      │  │   工具函数    │ │
│  │  (OpenAI API)   │  │   (Passport)    │  │  (Utils)     │ │
│  └─────────────────┘  └─────────────────┘  └──────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

## 模块职责

### 表示层

#### 控制器 (Controllers)

控制器负责处理HTTP请求，调用相应的服务，并返回响应。主要控制器包括：

- **AdminController**: 管理后台相关功能
- **BlogController**: 博客前端展示相关功能
- **AuthController**: 用户认证相关功能

#### API路由 (API Routes)

API路由定义了系统的RESTful API接口，供第三方应用集成使用。

### 业务逻辑层

#### 内容生成服务 (ContentGenerator)

负责使用AI模型生成博客内容，主要功能包括：

- 根据主题生成文章内容
- 批量生成多篇文章
- 管理生成历史记录

#### 主题服务 (TopicService)

负责主题的业务逻辑，主要功能包括：

- 创建、更新和删除主题
- 管理主题的关键词和分类
- 获取主题相关的文章

#### 文章服务 (PostService)

负责文章的业务逻辑，主要功能包括：

- 创建、更新和删除文章
- 发布和取消发布文章
- 文章内容处理和格式化

#### SEO服务 (SEOService)

负责SEO相关功能，主要包括：

- 生成和更新站点地图
- 优化文章的元数据
- 提供SEO统计和分析

#### 调度服务 (Scheduler)

负责定时任务的调度，主要功能包括：

- 定时生成内容
- 定时发布文章
- 定时更新站点地图

#### 用户服务 (UserService)

负责用户相关的业务逻辑，主要功能包括：

- 用户注册和登录
- 用户权限管理
- 用户偏好设置

### 数据访问层

#### 文章仓库 (PostRepository)

负责文章数据的存储和检索，提供以下功能：

- 获取文章列表（支持分页、过滤和排序）
- 获取文章详情
- 创建、更新和删除文章

#### 主题仓库 (TopicRepository)

负责主题数据的存储和检索，提供以下功能：

- 获取主题列表
- 获取主题详情
- 创建、更新和删除主题
- 获取主题相关的文章

#### 用户仓库 (UserRepository)

负责用户数据的存储和检索，提供以下功能：

- 获取用户信息
- 创建和更新用户
- 用户认证

### 基础设施层

#### 数据库 (MongoDB)

使用MongoDB作为数据存储，主要集合包括：

- posts: 存储文章数据
- topics: 存储主题数据
- users: 存储用户数据
- generations: 存储内容生成历史

#### 日志系统 (Logger)

使用Winston实现的日志系统，支持多级别日志和文件轮转。

#### 配置管理 (Config)

负责管理系统配置，支持从环境变量和配置文件加载配置。

#### AI接口 (OpenAI API)

封装了与OpenAI API的交互，提供内容生成功能。

#### 认证系统 (Passport)

使用Passport.js实现的认证系统，支持多种认证策略。

#### 工具函数 (Utils)

提供各种通用工具函数，如分页、Markdown解析、URL处理等。

## 数据流

### 内容生成流程

1. 用户在管理后台触发内容生成
2. AdminController调用ContentGenerator服务
3. ContentGenerator服务调用OpenAI API生成内容
4. ContentGenerator服务调用PostRepository保存生成的文章
5. 返回生成结果给用户

### 文章发布流程

1. 用户在管理后台发布文章
2. AdminController调用PostService
3. PostService更新文章状态为"published"
4. PostService调用SEOService更新站点地图
5. 返回发布结果给用户

## 扩展点

系统设计了多个扩展点，方便进行功能扩展：

### 内容生成策略

可以通过实现新的生成策略来支持不同的内容生成方式：

```javascript
// 示例：添加新的生成策略
class SpecializedContentStrategy {
  async generate(topic, options) {
    // 实现特定领域的内容生成逻辑
  }
}

// 在ContentGenerator中注册
contentGenerator.registerStrategy('specialized', new SpecializedContentStrategy());
```

### 认证策略

可以添加新的认证策略来支持不同的登录方式：

```javascript
// 示例：添加新的认证策略
passport.use(new CustomStrategy(
  function(token, done) {
    // 实现自定义认证逻辑
  }
));
```

### SEO优化插件

可以添加新的SEO优化插件来增强SEO功能：

```javascript
// 示例：添加新的SEO优化插件
seoService.registerPlugin('keywordDensity', {
  analyze: function(content) {
    // 实现关键词密度分析
  },
  optimize: function(content, keywords) {
    // 实现关键词密度优化
  }
});
```

## 技术债务和改进计划

当前系统存在以下技术债务，计划在未来版本中改进：

1. **测试覆盖率不足**：需要增加单元测试和集成测试
2. **错误处理不统一**：需要实现统一的错误处理机制
3. **缺乏API文档**：需要使用Swagger或类似工具生成API文档
4. **性能优化**：需要优化数据库查询和内容生成性能
5. **国际化支持**：需要添加多语言支持 