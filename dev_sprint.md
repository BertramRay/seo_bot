SEO 博客生成系统 - 多租户与自定义域名功能渐进式开发方案
开发阶段概览
我们将采用渐进式开发方法，将整个功能分解为多个独立的阶段，每个阶段都有明确的目标和可验证的成果。每个阶段完成后，我们将进行功能验证，确保开发的功能符合预期，然后再进入下一阶段。
阶段划分
阶段 1: 用户模型扩展与基础设置页面
扩展用户模型，添加域名相关字段
创建基础的域名设置页面
实现子域名设置的基本功能
阶段 2: 域名验证服务
实现域名验证服务
添加手动验证功能
完善域名状态管理
阶段 3: 自定义域名支持
实现自定义域名配置功能
生成 DNS 配置指南
添加自定义域名验证
阶段 4: 多租户路由中间件
实现租户解析中间件
根据域名自动识别租户
调整现有控制器支持多租户
阶段 5: Railway 部署配置
准备 Railway 部署配置
设置环境变量
配置域名和 SSL 证书
阶段 6: 用户界面优化与文档
优化用户界面体验
添加详细的帮助信息
编写用户文档
详细开发计划
阶段 1: 用户模型扩展与基础设置页面
目标: 扩展用户模型并创建基础的域名设置页面
任务:
扩展用户模型，添加以下字段:
subdomain: 子域名
customDomain: 自定义域名
domainStatus: 域名状态
domainVerifiedAt: 域名验证时间
sslStatus: SSL 证书状态
blogSettings: 博客设置对象
创建域名设置页面路由和控制器:
添加 /admin/domain-settings 路由
创建 getDomainSettings 控制器方法
创建基础的域名设置视图
实现子域名设置功能:
添加子域名表单
实现 postUpdateSubdomain 控制器方法
添加子域名格式验证
检查子域名唯一性
验证标准:
用户模型成功扩展，可以存储域名相关信息
域名设置页面可以正常访问
用户可以输入并保存子域名
系统能够验证子域名格式和唯一性
阶段 2: 域名验证服务
目标: 实现域名验证服务，验证用户配置的域名
任务:
创建域名验证服务:
实现 domainVerifier.js 服务
添加 scheduleVerification 方法
添加 verifyDomain 方法
实现 DNS 验证逻辑:
使用 DNS 模块验证 CNAME 记录
更新域名状态
记录验证时间
添加手动验证功能:
实现 postVerifyDomain 控制器方法
在域名设置页面添加验证按钮
显示验证结果和错误信息
验证标准:
域名验证服务可以正常工作
系统能够验证 DNS 配置是否正确
用户可以手动触发验证
验证结果正确反映在用户界面上
阶段 3: 自定义域名支持
目标: 实现自定义域名配置和验证功能
任务:
实现自定义域名配置:
在域名设置页面添加自定义域名表单
实现 postUpdateCustomDomain 控制器方法
添加域名格式验证
检查域名唯一性
生成 DNS 配置指南:
为自定义域名生成 CNAME 记录信息
在域名设置页面显示 DNS 配置指南
添加配置说明和注意事项
扩展域名验证服务:
添加自定义域名验证逻辑
处理不同类型的验证错误
更新验证状态显示
验证标准:
用户可以配置自定义域名
系统生成正确的 DNS 配置指南
域名验证服务可以验证自定义域名
验证结果正确反映在用户界面上
阶段 4: 多租户路由中间件
目标: 实现租户解析中间件，根据域名自动识别租户
任务:
创建租户解析中间件:
实现 tenantResolver.js 中间件
添加 resolveTenant 方法
根据请求的主机名识别租户
集成到应用程序:
在主应用程序中注册中间件
将租户信息附加到请求对象
处理未找到租户的情况
调整现有控制器:
修改博客控制器使用租户信息
确保内容隔离
添加租户特定的视图渲染
验证标准:
系统能够根据域名正确识别租户
不同租户的内容完全隔离
通过自定义域名访问时显示正确的内容
未找到租户时显示适当的错误页面
阶段 5: Railway 部署配置
目标: 准备 Railway 部署配置，支持多租户和自定义域名
任务:
准备 Railway 配置:
创建 railway.json 配置文件
设置必要的环境变量
配置构建和启动命令
配置域名设置:
在 Railway 中设置主域名
配置通配符子域名支持
设置自定义域名处理
SSL 证书配置:
配置 Railway 的自动 SSL 功能
处理证书更新
确保所有域名使用 HTTPS
验证标准:
Railway 配置文件正确设置
应用可以在 Railway 上成功部署
主域名和子域名可以正常访问
SSL 证书正确配置，所有域名使用 HTTPS
阶段 6: 用户界面优化与文档
目标: 优化用户界面体验，添加帮助信息和文档
任务:
优化用户界面:
改进域名设置页面布局
添加状态指示器和提示信息
实现响应式设计
添加帮助信息:
创建详细的域名配置指南
添加常见问题解答
提供故障排除建议
编写用户文档:
更新用户指南
添加域名配置章节
提供分步教程
验证标准:
用户界面美观且易于使用
帮助信息清晰且有用
用户文档全面且易于理解
整体用户体验流畅
验证方法
每个阶段完成后，我们将使用以下方法验证功能:
功能测试: 手动测试所有新功能，确保它们按预期工作
代码审查: 审查代码质量，确保符合最佳实践
用户测试: 邀请测试用户尝试新功能，收集反馈
集成测试: 确保新功能与现有系统正确集成
性能测试: 评估新功能对系统性能的影响
只有当一个阶段的所有验证标准都满足时，我们才会进入下一个开发阶段。
时间估计
| 阶段 | 估计时间 |
|------|----------|
| 阶段 1: 用户模型扩展与基础设置页面 | 3-5 天 |
| 阶段 2: 域名验证服务 | 4-6 天 |
| 阶段 3: 自定义域名支持 | 3-5 天 |
| 阶段 4: 多租户路由中间件 | 5-7 天 |
| 阶段 5: Railway 部署配置 | 2-3 天 |
| 阶段 6: 用户界面优化与文档 | 3-4 天 |
| 总计 | 20-30 天 |
这个渐进式开发方案将帮助我们有条不紊地实现多租户与自定义域名功能，每个阶段都有明确的目标和可验证的成果，确保开发过程的质量和效率。